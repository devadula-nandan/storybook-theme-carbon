@use "@carbon/layout";
@use "@carbon/styles/scss/theme";
@use "@carbon/styles/scss/spacing";
@use "@carbon/styles/scss/components/button/tokens" as button-tokens;
@use "mixins";
@use "panel-shared";

/**
 * PANEL STYLES
 * Main styles for the Storybook panel area (bottom/right panel)
 * Includes Controls, Actions, Interactions, and A11y addons
 */

#panel-tab-content {
  height: calc(100% - 41px) !important;
  margin-top: 1px !important;
  background: theme.$background !important;

  /**
   * Paragraph Text Color
   */
  p {
    color: theme.$text-secondary;
  }

  /**
   * Scrollbar Styling
   * Custom scrollbar for Radix UI scroll areas
   */
  [data-radix-scroll-area-viewport] {
    + div > div {
      background: theme.$border-inverse;
    }
  }

  /**
   * ==========================================================
   * CONTROLS ADDON
   * ==========================================================
   */

  /**
   * Save From Controls Action
   * Toolbar action to save control state
   */
  [id="save-from-controls"] {
    > div {
      --highlight-bg-color: color-mix(
        in srgb,
        var(--cds-border-interactive) 30%,
        var(--cds-layer-01)
      );

      background-color: theme.$layer-01;
      border-color: theme.$border-subtle-01;
      color: theme.$text-secondary;

      button {
        @include panel-shared.panel-button;
      }
    }
  }

  /**
   * Reset Controls Button
   * Button to reset all controls to default values
   */
  button[title="Reset controls"] {
    @include panel-shared.panel-button;
  }

  /**
   * Controls ArgTable
   * Table showing component props/args with editable controls
   */
  table.docblock-argstable {
    @include mixins.argstable-base;

    > thead.docblock-argstable-head {
      background-color: theme.$layer;
    }

    /**
     * Table Body
     * Rows containing control inputs
     */
    > tbody.docblock-argstable-body {
      /**
       * Standard Control Rows
       * Individual prop/arg rows with controls
       */
      > tr:not([title]) > td {
        background: theme.$background;
        border-color: theme.$border-subtle-01;
        color: theme.$text-secondary;

        /**
         * Type Badges
         * Display type information (string, number, etc.)
         * Using attribute selector instead of specific CSS classes
         */
        [class*="css-"] {
          @include mixins.argstable-type-badge;
          border-color: theme.$border-subtle-01;
        }

        /**
         * Required Indicator
         * Shows which props are required
         */
        span[title="Required"] {
          @include mixins.argstable-required;
        }

        /**
         * Form Controls
         * All input types within the controls table
         */
        @include panel-shared.form-controls;

        /**
         * Checkbox Styling
         */
        input[type="checkbox"]:not([role="switch"]) {
          @include panel-shared.checkbox;
        }

        /**
         * Radio Button Styling
         */
        input[type="radio"] {
          @include panel-shared.radio-button;
        }

        /**
         * Toggle Switch Styling
         */
        @include panel-shared.toggle-switch;

        /**
         * Date/Time Inputs
         */
        @include panel-shared.date-time-inputs;

        /**
         * Range Inputs
         */
        @include panel-shared.range-input;
      }

      /**
       * Array/Object Item Rows
       * Expandable rows for complex control types
       */
      > tr[title~="items"] {
        @include mixins.argstable-item-row;
        box-shadow: inset 0 1px 0 0 theme.$border-subtle-01;
      }
    }
  }

  /**
   * Code Source Block
   * Syntax-highlighted code examples in docs
   */
  .docblock-source {
    background-color: theme.$background;
    border-radius: 0;
    border: 1px solid theme.$border-subtle-01;
  }

  > div:has(.docblock-source) {
    height: 100%;
  }

  /**
   * ==========================================================
   * INTERACTIONS ADDON
   * ==========================================================
   * Panel for play function interactions and testing
   */
  /**
   * Interactions Panel Container
   */
  div:has(nav[aria-label="Component tests toolbar"]) {
    background-color: var(--cds-background);

    /**
     * Interactions Toolbar
     * Controls for play function testing (play, rewind, etc.)
     */
    nav[aria-label="Component tests toolbar"] {
      box-sizing: content-box;
      border-bottom: 1px solid theme.$border-subtle-01;
      padding: 0;
      background: theme.$layer-01;

      > div > p {
        color: theme.$text-primary;
      }

      /**
       * Test Status Badge
       * Shows pass/fail/running status
       */
      div[aria-label="Status of the test run"] {
        min-block-size: spacing.$spacing-08;
        min-inline-size: spacing.$spacing-10;
        border-radius: 0;
        align-content: center;
      }

      /**
       * Hide empty spans
       */
      span:empty {
        display: none;
      }

      /**
       * Toolbar Buttons
       */
      button {
        @include mixins.button("lg");
        margin: 0;

        &[disabled] {
          @include mixins.button("lg", "ghost", true, false);
        }
      }
    }

    /**
     * Interactions List
     * List of interaction steps from play function
     */
    div[aria-label="Interactions list"] {
      div:has(> button[aria-label="Interaction step"]) {
        @include mixins.button(null, "ghost", false);
      }

      > div {
        border-color: theme.$border-subtle-01 !important;
      }
    }
  }
  /**
   * ==========================================================
   * ACCESSIBILITY (A11Y) ADDON
   * ==========================================================
   * Panel for accessibility violation detection
   */

  /**
   * A11y Tabs Container
   * Violations, Passes, Incomplete tabs
   */
  div:has(> div > [data-type="violations"]) {
    background-color: theme.$layer-01;
    padding: 0;
    border-block-end: 1px solid theme.$border-subtle-01;
    box-shadow: none;

    div[role="tablist"] + div {
      gap: 0;
    }

    /**
     * Non-Tab Buttons in A11y Header
     * Settings and other action buttons
     */
    button:not([role="tab"]) {
      @include mixins.button("lg");
    }

    /**
     * A11y Tab Buttons
     * Violations, Passes, Incomplete tabs
     */
    button[role="tab"] {
      @include mixins.tab-button;

      /**
       * Violation Count Badge
       */
      > div > div {
        @include mixins.badge;
      }
    }

    /**
     * Active Tab State
     */
    button[data-active="true"] {
      @include mixins.tab-active;

      > div > div {
        @include mixins.badge(true);
      }
    }
  }

  /**
   * A11y Violation List
   * List of accessibility issues and their details
   */
  div:has(> div > [data-type="violations"]) + div {
    /**
     * Individual Violation Items
     * Clickable rows showing violation summary
     */
    [data-active] {
      background-color: theme.$layer-01;

      &:hover {
        color: theme.$interactive;
        background-color: theme.$layer-hover-01;

        + div {
          background-color: theme.$layer-hover-01;
        }
      }

      > div:first-child {
        > div:last-child {
          color: theme.$text-secondary;
        }
      }

      > :nth-last-child(2) {
        color: theme.$text-secondary;
      }

      /**
       * Action Buttons in Violation Row
       * Highlight, copy, etc.
       */
      > button {
        @include panel-shared.panel-button;
      }
    }

    /**
     * Violation Details Panel
     * Expanded view showing full violation information
     */
    [data-active] + [id*="details"] {
      background-color: theme.$layer-01;

      /**
       * Help Links
       * External links to WCAG guidelines
       */
      p > a > span {
        color: theme.$link-primary;

        > svg {
          margin-bottom: -1px;

          > path {
            fill: theme.$link-primary;
          }
        }
      }

      > div:first-child {
        > div:first-child {
          color: theme.$text-secondary;
        }
      }

      /**
       * Detail Tabs (HTML, Highlight)
       * Additional information tabs within violation details
       */
      [role="tablist"],
      [role="tabpanel"] {
        button {
          @include mixins.button(null, "ghost", true, true);
          color: theme.$text-secondary;
          box-shadow: inset 0 0 0 1px theme.$border-subtle-01;
        }
      }
    }

    /**
     * Scroll Area Content
     */
    [data-radix-scroll-area-content] {
      > div {
        background-color: inherit;
        border-color: theme.$border-subtle-01;
      }
    }
  }
}
