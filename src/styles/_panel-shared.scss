@use "@carbon/layout";
@use "@carbon/styles/scss/theme";
@use "@carbon/styles/scss/spacing";
@use "@carbon/styles/scss/components/button/tokens" as button-tokens;
@use "mixins";
@use "defaults";

/**
 * SHARED PANEL COMPONENT STYLES
 * Reusable styles for buttons, form controls, and common panel elements
 */

/**
 * Standard Panel Button
 * Used throughout panel tabs (Controls, A11y, etc.)
 * @param {string} $size - Button size (default: "sm")
 */
@mixin panel-button($size: "sm") {
  @include mixins.button($size);
}

/**
 * Form Control Base Styles
 * Shared styling for inputs, textareas, and selects
 * Combines input field and border bottom styles
 */
@mixin form-control-base {
  @include mixins.input-field;
  @include mixins.input-border-bottom;
}

/**
 * Form Control Selector
 * Reusable selector for form controls excluding radio and checkbox
 */
$form-control-selector: "input:not([type='radio']):not([type='checkbox'])";

/**
 * Form Control Group
 * Styles for button, input, textarea, and select elements
 * Provides consistent styling across all form controls
 */
@mixin form-controls {
  // Base styles for all form controls
  button,
  #{$form-control-selector},
  textarea,
  select {
    border-radius: 0;
    box-shadow: none;
    background-color: theme.$layer-01;
  }

  // Text input specific styles
  #{$form-control-selector}:not([type="range"]),
  textarea,
  select {
    @include mixins.input-border-bottom;
    color: theme.$text-secondary;
  }

  // Placeholder styles
  #{$form-control-selector}::placeholder,
  textarea::placeholder,
  select::placeholder {
    color: theme.$text-secondary;
  }

  // Hover states
  button:hover,
  #{$form-control-selector}:hover,
  textarea:hover,
  select:hover {
    background-color: theme.$layer-hover-01;
  }

  // Active states
  button:active,
  #{$form-control-selector}:active,
  textarea:active,
  select:active {
    background-color: theme.$layer-active-01;
  }

  // Focus states
  button:focus,
  #{$form-control-selector}:focus,
  textarea:focus,
  select:focus {
    @include mixins.focus-state;
  }
}

/**
 * Custom Radio Button
 * Carbon-styled radio input with proper accessibility
 * @example
 *   input[type="radio"] {
 *     @include radio-button;
 *   }
 */
@mixin radio-button {
  // Reset default appearance
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  // Size and shape
  width: 1rem;
  height: 1rem;
  border-radius: 50%;

  // Colors and borders
  border: 1px solid theme.$icon-primary;
  background-color: theme.$background;

  // Interaction
  cursor: pointer;
  position: relative;

  // Smooth transitions using defaults
  transition:
    border-color defaults.$transition-duration
      defaults.$transition-timing-function,
    background-color defaults.$transition-duration
      defaults.$transition-timing-function,
    box-shadow defaults.$transition-duration
      defaults.$transition-timing-function;

  // Checked state indicator
  &:checked::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0.5rem;
    height: 0.5rem;
    border-radius: 50%;
    background-color: theme.$icon-primary;
    transform: translate(-50%, -50%);
  }

  // Focus state for accessibility
  &:focus {
    outline: none;
    box-shadow: 0 0 0 2px theme.$focus;
  }
}

/**
 * Custom Checkbox
 * Carbon-styled checkbox input with proper accessibility
 * @example
 *   input[type="checkbox"] {
 *     @include checkbox;
 *   }
 */
@mixin checkbox {
  // Reset default appearance
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  // Size and shape
  width: 1rem;
  height: 1rem;
  border-radius: 0;

  // Colors and borders
  border: 1px solid theme.$icon-primary;
  background-color: theme.$background;

  // Interaction
  cursor: pointer;
  position: relative;

  // Smooth transitions using defaults
  transition:
    border-color defaults.$transition-duration
      defaults.$transition-timing-function,
    background-color defaults.$transition-duration
      defaults.$transition-timing-function,
    box-shadow defaults.$transition-duration
      defaults.$transition-timing-function;

  // Checked state indicator (checkmark)
  &:checked {
    background-color: theme.$icon-primary;
    border-color: theme.$icon-primary;

    &::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 3px;
      height: 6px;
      border: solid theme.$background;
      border-width: 0 2px 2px 0;
      transform: translate(-50%, -60%) rotate(45deg);
    }
  }

  // Focus state for accessibility
  &:focus {
    outline: none;
    box-shadow: 0 0 0 2px theme.$focus;
  }

  // Hover state
  &:hover:not(:disabled) {
    border-color: theme.$icon-secondary;
  }

  // Disabled state
  &:disabled {
    cursor: not-allowed;
    opacity: 0.5;
    border-color: theme.$icon-disabled;

    &:checked {
      background-color: theme.$icon-disabled;
    }
  }
}

/**
 * Toggle Switch Styles
 * Carbon-styled toggle switch with proper states and animations
 * Matches Carbon Design System toggle component
 */
@mixin toggle-switch {
  // Boolean control container
  [aria-label="booleanControl"] {
    * {
      color: theme.$text-secondary;
    }
  }

  // Label container for the toggle
  label:has(input[role="switch"]) {
    background-color: transparent;
    border-radius: spacing.$spacing-05;
    display: inline-flex;
  }

  // The actual toggle switch input
  input[role="switch"] {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    position: relative;
    width: 3rem;
    height: 1.5rem;
    border-radius: 0.75rem;
    background-color: theme.$toggle-off;
    border: none;
    cursor: pointer;
    transition:
      background-color defaults.$transition-duration
        defaults.$transition-timing-function,
      box-shadow defaults.$transition-duration
        defaults.$transition-timing-function;

    // Toggle handle (the circle that moves)
    &::before {
      content: "";
      position: absolute;
      top: 3px;
      left: 3px;
      width: 1.125rem;
      height: 1.125rem;
      border-radius: 50%;
      background-color: theme.$icon-on-color;
      transition:
        transform defaults.$transition-duration
          defaults.$transition-timing-function,
        background-color defaults.$transition-duration
          defaults.$transition-timing-function;
    }

    // Checked state - toggle is ON
    &:checked {
      background-color: theme.$support-success;

      &::before {
        transform: translateX(1.5rem);
      }
    }

    // Focus state
    &:focus {
      outline: none;
      box-shadow: 0 0 0 2px theme.$focus !important;
    }

    // Hover state
    &:hover:not(:disabled) {
      &::before {
        background-color: theme.$icon-on-color;
      }
    }

    // Disabled state
    &:disabled {
      cursor: not-allowed;
      opacity: 0.5;
      background-color: button-tokens.$button-disabled;

      &::before {
        background-color: theme.$icon-disabled;
      }
    }
  }

  label:has(input[role="switch"]) {
    span {
      display: none;
    }

    /* checked → show TRUE (second span) */
    input[role="switch"]:checked + span + span {
      display: inline;
      box-shadow: none;
      background-color: transparent;
      color: theme.$text-secondary;
    }

    /* unchecked → show FALSE (first span) */
    input[role="switch"]:not(:checked) + span {
      display: inline;
      box-shadow: none;
      background-color: transparent;
      color: theme.$text-secondary;
    }
  }
}

/**
 * Date/Time Input Color Scheme
 * Adjusts color scheme based on theme
 */
@mixin date-time-inputs {
  input[type="date"],
  input[type="time"] {
    color-scheme: light;
  }

  :root[storybook-carbon-theme="g90"] &,
  :root[storybook-carbon-theme="g100"] & {
    input[type="date"],
    input[type="time"] {
      color-scheme: dark;
    }
  }
}

/**
 * Range Input Styles
 * Cross-browser compatible range slider styling with Carbon design tokens
 * Based on CSS-Tricks guide for comprehensive browser support
 * Supports: Chrome, Safari, Firefox, Edge, and IE
 */
@mixin range-input {
  input[type="range"] {
    // Reset default appearance for all browsers
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 100%;
    background: transparent;
    outline: none;
    cursor: pointer;
    margin: spacing.$spacing-03 0;

    // Remove default focus outline
    &:focus {
      outline: none;
    }

    // ===== WEBKIT (Chrome, Safari, Edge Chromium) =====
    // Track
    &::-webkit-slider-runnable-track {
      width: 100%;
      height: 2px;
      background: theme.$border-strong-01;
      border: none;
      border-radius: 0;
      cursor: pointer;
    }

    // Thumb
    &::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      background: theme.$icon-primary;
      border: 2px solid theme.$background;
      border-radius: 50%;
      cursor: pointer;
      margin-top: -6px; // Center thumb on track (thumb height - track height) / 2
      box-shadow: none;
      transition:
        background-color defaults.$transition-duration
          defaults.$transition-timing-function,
        box-shadow defaults.$transition-duration
          defaults.$transition-timing-function,
        transform defaults.$transition-duration
          defaults.$transition-timing-function;
    }

    // ===== MOZILLA FIREFOX =====
    // Track
    &::-moz-range-track {
      width: 100%;
      height: 2px;
      background: theme.$border-strong-01;
      border: none;
      border-radius: 0;
      cursor: pointer;
    }

    // Thumb
    &::-moz-range-thumb {
      width: 14px;
      height: 14px;
      background: theme.$icon-primary;
      border: 2px solid theme.$background;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: none;
      transition:
        background-color defaults.$transition-duration
          defaults.$transition-timing-function,
        box-shadow defaults.$transition-duration
          defaults.$transition-timing-function,
        transform defaults.$transition-duration
          defaults.$transition-timing-function;
    }

    // Progress/lower fill (Firefox only)
    &::-moz-range-progress {
      height: 2px;
      background: theme.$border-interactive;
      border-radius: 0;
    }

    // ===== MICROSOFT EDGE (Legacy) & IE =====
    // Track
    &::-ms-track {
      width: 100%;
      height: 2px;
      background: transparent;
      border-color: transparent;
      color: transparent;
      cursor: pointer;
    }

    // Fill/lower track
    &::-ms-fill-lower {
      background: theme.$border-interactive;
      border: none;
      border-radius: 0;
    }

    // Upper track
    &::-ms-fill-upper {
      background: theme.$border-strong-01;
      border: none;
      border-radius: 0;
    }

    // Thumb
    &::-ms-thumb {
      width: 14px;
      height: 14px;
      background: theme.$icon-primary;
      border: 2px solid theme.$background;
      border-radius: 50%;
      cursor: pointer;
      margin-top: 0; // IE doesn't need margin adjustment
      box-shadow: none;
    }

    // Tooltip (IE only)
    &::-ms-tooltip {
      display: none;
    }

    // ===== HOVER STATES =====
    &:hover::-webkit-slider-thumb {
      background: theme.$icon-secondary;
      transform: scale(1.1);
    }

    &:hover::-moz-range-thumb {
      background: theme.$icon-secondary;
      transform: scale(1.1);
    }

    &:hover::-ms-thumb {
      background: theme.$icon-secondary;
    }

    // ===== FOCUS STATES =====
    &:focus::-webkit-slider-thumb {
      box-shadow: 0 0 0 2px theme.$focus;
    }

    &:focus::-moz-range-thumb {
      box-shadow: 0 0 0 2px theme.$focus;
    }

    &:focus::-ms-thumb {
      box-shadow: 0 0 0 2px theme.$focus;
    }

    // ===== ACTIVE/PRESSED STATES =====
    &:active::-webkit-slider-thumb {
      background: theme.$icon-primary;
      transform: scale(1);
    }

    &:active::-moz-range-thumb {
      background: theme.$icon-primary;
      transform: scale(1);
    }

    &:active::-ms-thumb {
      background: theme.$icon-primary;
    }

    // ===== DISABLED STATE =====
    &:disabled {
      cursor: not-allowed;
      opacity: 0.5;

      &::-webkit-slider-runnable-track {
        cursor: not-allowed;
      }

      &::-webkit-slider-thumb {
        cursor: not-allowed;
        background: theme.$icon-disabled;
      }

      &::-moz-range-track {
        cursor: not-allowed;
      }

      &::-moz-range-thumb {
        cursor: not-allowed;
        background: theme.$icon-disabled;
      }

      &::-ms-track {
        cursor: not-allowed;
      }

      &::-ms-fill-lower,
      &::-ms-fill-upper {
        background: theme.$border-subtle;
      }

      &::-ms-thumb {
        cursor: not-allowed;
        background: theme.$icon-disabled;
      }
    }
  }
}
